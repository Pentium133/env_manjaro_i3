#! /usr/bin/env sh

RESET_CODE=0
BOLD=1
DIM=2
UNDERLINED=4
BLINK=5
REVERSE=7
HIDDEN=8

DEFAULT=39
BLACK=30
RED=31
GREEN=32
YELLOW=33
BLUE=34
MAGENTA=35
CYAN=36
LIGHT_GRAY=37
DARK_GRAY=90
LIGHT_RED=91
LIGHT_GREEN=92
LIGHT_YELLOW=93
LIGHT_BLUE=94
LIGHT_MAGENTA=95
LIGHT_CYAN=96
WHITE=97

BG_DEFAULT=49
BG_BLACK=40
BG_RED=41
BG_GREEN=42
BG_YELLOW=43
BG_BLUE=44
BG_MAGENTA=45
BG_CYAN=46
BG_LIGHT_GRAY=47
BG_DARK_GRAY=100
BG_LIGHT_RED=101
BG_LIGHT_GREEN=102
BG_LIGHT_YELLOW=103
BG_LIGHT_BLUE=104
BG_LIGHT_MAGENTA=105
BG_LIGHT_CYAN=106
BG_WHITE=107


function attr(){
  local msg=$1
  local codes=""

  for name in "${@:2}"; do
    local code="${(P)name}"
    codes="${codes}\e[${code}m"
  done

  echo -e "${codes}${msg}\e[${RESET_CODE}m"
}


function log_info() { attr "[INFO] $1" DARK_GRAY; return; }

function log_err()  { attr "[ERROR] $1" RED;  return; }


function touch_dir(){
  local dir=$1
  if [ ! -d "$dir" ]; then
    mkdir -p $dir
    log_info "[$dir] has been created"
  fi
  return;
}

function strlen(){
  local str=$1
  echo ${#str}
}

function is_pos(){
  local result=$(($1 < 0))
  return $result;
}

function is_valid_range(){
  local result=$(($1 > $2))
  return $result;
}

function is_valid_abs_range(){
  if is_pos $1 && is_pos $2 && is_valid_range $1 $2; then
    return 0;
  else
    return 1;
  fi
}

function substring(){
  local str=$1
  local from=$2
  local to=$3
  local length=$(strlen $str)

  if ! is_valid_abs_range $from $to ; then
    log_err "range [$from, $to] is out of bound string [len=$length]"
    return;
  fi

  if (($from > $length)) || (($to > $length)); then
    log_err "range [$from, $to] is out of bound string [len=$length]"
    return;
  fi

  local result=${str:$from:$(($to))}
  echo "$result"
}

function drop_right(){
  local str=$1
  local n=$2
  local length=$(strlen $str)

  if (($n > $length)) || (($n < 0)); then
    log_err "[n=$n] out of range string [length=$length]"
    return;
  fi

  local from=0
  local to=$length-$n

  local result=$(substring $str $from $to)
  
  echo $result
}

function drop_left(){
  local str=$1
  local n=$2
  local length=$(strlen $str)

  if (($n > $length)) || (($n < 0)); then
    log_err "[n=$n] out of range string [length=$length]"
    return;
  fi

  local from=$n
  local to=$length

  local result=$(substring $str $from $to)
  
  echo $result
}

function fill_right(){
  local str=$1
  local chr=$2
  local n=$3

  if (($n < 0)); then
    log_err "[n=$n] should be >= 0"
    return;
  fi

  local i="0"
  while [ $i -lt $n ]
  do
    i=$[$i+1]
    str="$str$chr"
  done

  echo $str
}

function fill_left(){
  local str=$1
  local chr=$2
  local n=$3

  if (($n < 0)); then
    log_err "[n=$n] should be >= 0"
    return;
  fi

  local i="0"
  while [ $i -lt $n ]
  do
    i=$[$i+1]
    str="$chr$str"
  done

  echo $str
}
